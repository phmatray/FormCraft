@inherits LayoutComponentBase
@inject IVersionService VersionService
@inject IDemoRegistry DemoRegistry
@inject NavigationManager Navigation

<MudThemeProvider Theme="_theme" IsDarkMode="@_isDarkMode" />
<MudPopoverProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout>
    <MudAppBar Elevation="1" Dense="false">
        <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" OnClick="@ToggleDrawer" />
        <MudLink Class="d-flex align-center" Style="text-decoration: none; color: inherit; cursor: pointer;" @onclick="NavigateToHome">
            <MudIcon Icon="@Icons.Material.Filled.DynamicForm" Class="ml-3 me-2" Size="Size.Large" Style="color: white;" />
            <MudText Typo="Typo.h5" Class="font-weight-bold" Style="color: white;">
                FormCraft
            </MudText>
        </MudLink>
        <MudChip T="string" Text="@($"v{_version}")" Size="Size.Small" Color="Color.Primary" Class="ml-2 mt-1" />
        <MudSpacer />
        
        <MudTooltip Text="Toggle light/dark mode">
            <MudIconButton
                Icon="@(_isDarkMode ? Icons.Material.Filled.LightMode : Icons.Material.Filled.DarkMode)" 
                Color="Color.Inherit" 
                OnClick="@ToggleTheme" />
        </MudTooltip>
        
        <MudDivider Vertical="true" FlexItem="true" Class="mx-2 my-2" />
        
        <MudButton
            Variant="Variant.Text" 
            Color="Color.Inherit" 
            StartIcon="@Icons.Material.Filled.MenuBook"
            Href="docs/getting-started">
            Docs
        </MudButton>
        
        <MudButton
            Variant="Variant.Text" 
            Color="Color.Inherit" 
            StartIcon="@Icons.Custom.Brands.GitHub" 
            Href="https://github.com/phmatray/FormCraft" 
            Target="_blank">
            GitHub
        </MudButton>
        
        <MudButton
            Variant="Variant.Filled" 
            Color="Color.Primary" 
            StartIcon="@Icons.Material.Filled.GetApp"
            Href="https://www.nuget.org/packages/FormCraft"
            Target="_blank"
            Class="ml-2">
            Get Started
        </MudButton>
    </MudAppBar>
    
    <MudDrawer @bind-Open="@_drawerOpen" ClipMode="DrawerClipMode.Always" Elevation="2" Breakpoint="Breakpoint.Md" Variant="DrawerVariant.Responsive">
        <MudNavMenu>
            <MudNavLink Href="home" Icon="@Icons.Material.Filled.Home">
                Welcome
            </MudNavLink>

            <MudNavGroup Title="Demos" Icon="@Icons.Material.Filled.Dashboard" Expanded="true">
                @foreach (var level in _levels)
                {
                    var levelInfo = DemoRegistry.GetLevelInfo(level);
                    var demos = DemoRegistry.GetDemosByLevel(level);

                    <MudNavGroup Title="@levelInfo.Name" Icon="@levelInfo.Icon" Expanded="@(level == Services.DemoRegistry.Levels.Beginner)">
                        <div class="d-flex align-center mb-1 px-4">
                            <MudChip T="string" Size="Size.Small" Color="@levelInfo.Color" Class="me-2">@demos.Count demos</MudChip>
                            <MudText Typo="Typo.caption" Class="text-muted">@GetLevelSubtitle(level)</MudText>
                        </div>
                        @foreach (var demo in demos)
                        {
                            <MudNavLink Href="@demo.Id" Icon="@demo.Icon">
                                <div class="d-flex align-center">
                                    <span>@demo.Title</span>
                                    @if (demo.IsLevelEntryPoint && level == Services.DemoRegistry.Levels.Beginner)
                                    {
                                        <MudChip T="string" Size="Size.Small" Color="Color.Success" Class="ms-2" Style="font-size: 0.65rem; height: 18px;">START</MudChip>
                                    }
                                    else if (demo.IsLevelEntryPoint)
                                    {
                                        <MudIcon Icon="@Icons.Material.Filled.Star" Size="Size.Small" Color="@levelInfo.Color" Class="ms-2" />
                                    }
                                </div>
                            </MudNavLink>
                        }
                    </MudNavGroup>
                }
            </MudNavGroup>

            <MudNavGroup Title="Documentation" Icon="@Icons.Material.Filled.MenuBook" Expanded="true">
                @foreach (var doc in DemoRegistry.GetDemosByCategory("documentation"))
                {
                    <MudNavLink Href="@doc.Id" Icon="@doc.Icon">
                        @doc.Title
                    </MudNavLink>
                }
            </MudNavGroup>
        </MudNavMenu>
    </MudDrawer>
    
    <MudMainContent>
        <MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="my-4">
            @Body
        </MudContainer>
        
        <MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-8 mb-4">
            <MudDivider />
            <div class="d-flex justify-center align-center py-4">
                <MudText Typo="Typo.body2" Align="Align.Center" Class="text-muted">
                    Made with <MudIcon Icon="@Icons.Material.Filled.Favorite" Size="Size.Small" Color="Color.Error" Style="vertical-align: middle;" /> for Blazor
                </MudText>
            </div>
        </MudContainer>
    </MudMainContent>

    <MudScrollToTop>
        <MudFab Color="Color.Primary" StartIcon="@Icons.Material.Filled.KeyboardArrowUp" />
    </MudScrollToTop>
</MudLayout>

<div id="blazor-error-ui" data-nosnippet>
    An unhandled error has occurred.
    <a href="." class="reload">Reload</a>
    <span class="dismiss">ðŸ—™</span>
</div>

<style>
    .text-muted {
        opacity: 0.7;
    }
</style>